<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Documento sin título</title>
<style>
.borde_imagen {
background-color: #F5F5F5;
border: 5px solid #FFFFFF;
box-shadow: 0 0 22px #111111;
margin-top: 10px;
margin-bottom: 10px;
margin-right: 10px;
margin-left: 10px;
//width:50%;
}
.Table  
	{  
		display: table;  
	}  
.Title  
	{  
		display: table-caption;  
		text-align: center;  
		font-weight: bold;  
		font-size: larger;  
	}    
.Heading  
	{  
		display: table-row;  
		font-weight: bold; 
		text-align: center;  
	}  
.Row  
	{  
		display: table-row;  
	}  
.Cell  
	{  
		display: table-cell;  
		border: solid;  
		border-width: thin;  
		padding-left: 5px;  
		padding-right: 5px;  
	}  
</style>
<link href="jquery-mobile/jquery.mobile.theme-1.0.min.css" rel="stylesheet" type="text/css" />
<link href="jquery-mobile/jquery.mobile.structure-1.0.min.css" rel="stylesheet" type="text/css" />
<script src="jquery-mobile/jquery-1.6.4.min.js" type="text/javascript"></script>
<script src="jquery-mobile/jquery.mobile-1.0.min.js" type="text/javascript"></script>
<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/conexion.js"></script>
<script>
document.addEventListener("deviceready", onDeviceReady, false);
function onDeviceReady() 
	{
    		
	//document.getElementById('e_fabrica').value=device.manufacturer;
	//document.getElementById('e_modelo').value=device.model;
	//document.getElementById('e_plataforma').value=device.platform;
	//document.getElementById('e_version').value=device.version;
	////////insertamos la imagen a la tabla
	
	}	
document.addEventListener("backbutton", presskey, false);
function presskey()
	{
	location.href="menu_principal.html";
	document.removeEventListener("backbutton", presskey, false);
	}

function getParameterByName(name) 
	{
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
    results = regex.exec(location.search);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
	}
var usuario = getParameterByName('usuario');
var password = getParameterByName('password');
var nombre_usuario = getParameterByName('nombre_usuario');

console.log("usuario:"+usuario+" --");
console.log("password:"+password+" --");
console.log("nombre:"+nombre_usuario+" --");

$(document).ready(function() 
	{
		
		var dato="REGIONES";
		var formData = new FormData();
		formData.append("dato", dato);
		formData.append("usuario", nombre_usuario);
		$.ajax({
			type: 'POST',
			url: servidor+'/bodega_lodis_movil/checklist_checklist_guarda_dato_app2.php',
			data: formData,
			processData: false,
			contentType: false,
			success: function (result) 
				{
				console.log(result);
				var obj = JSON.parse(result);
				
				if (obj.regiones!=null)
					{
					var regionx = getParameterByName('region');
					$('#region').empty().append();
					$('#region').append('<option value="'+regionx+'">'+regionx+'</option>');
					for (i=0;i<obj.regiones.length;i++)
						{
						$('#region').append('<option value="'+obj.regiones[i]+'">'+obj.regiones[i]+'</option>');
						}
					
					$('#region').selectmenu('refresh')
					
					/////recibimos valor tipolocal externo/////
					var tipo_localx = getParameterByName('tipo_local');
					if (tipo_localx!='')
						{
						$('#tipo_local').empty().append();
						$('#tipo_local').append('<option value="'+tipo_localx+'">'+tipo_localx+'</option>');
						$('#tipo_local').append('<option value="KIOSCO">KIOSCO</option>');
						$('#tipo_local').append('<option value="TIENDA">TIENDA</option>');
						$('#tipo_local').selectmenu('refresh')
						carga_punto();
						carga_campanas();
						}
					/////recibimos valor tipolocal externo/////
					
					}
				
				}
			});
		
	})

function carga_punto()
	{
		var region=document.getElementById('region').value;
		var tipo_local=document.getElementById('tipo_local').value;
		var formData = new FormData();
		var dato='PUNTOS';
		formData.append("dato", dato);
		formData.append("region", region);
		formData.append("tipo_local", tipo_local);
		formData.append("usuario", nombre_usuario);
		$.ajax({
			type: 'POST',
			url: servidor+'/bodega_lodis_movil/checklist_checklist_guarda_dato_app2.php',
			data: formData,
			processData: false,
			contentType: false,
			success: function (result) 
				{
				console.log(result);
				var obj = JSON.parse(result);
				
				if (obj.puntos!=null)
					{
					var id_puntox = getParameterByName('id_punto');
					var puntox = getParameterByName('punto');
					$('#punto').empty().append();
					$('#punto').append('<option value="'+id_puntox+'">'+puntox+'</option>');
					for (i=0;i<obj.puntos.length;i++)
						{
						$('#punto').append('<option value="'+obj.id_puntos[i]+'">'+obj.puntos[i]+'</option>');
						}
					
					$('#punto').selectmenu('refresh')
					}
				
				}
			});

	}
function carga_layout()
	{
		var tipo_local=document.getElementById('tipo_local').value;
		var id_punto=document.getElementById('punto').value;
		var formData = new FormData();
		var dato='LAYOUTS';
		formData.append("dato", dato);
		formData.append("tipo_local", tipo_local);
		formData.append("id_punto",id_punto);
		formData.append("usuario", nombre_usuario);
		$.ajax({
			type: 'POST',
			url: servidor+'/bodega_lodis_movil/checklist_checklist_guarda_dato_app2.php',
			data: formData,
			processData: false,
			contentType: false,
			success: function (result) 
				{
				console.log(result);
				var obj = JSON.parse(result);
				
				if (obj.layouts!=null)
					{
					var layout_user=document.getElementById('layout').value;
					$('#layout').empty().append();
					if (layout_user!='')
						{
						$('#layout').append('<option value="'+layout_user+'">'+layout_user+'</option>');
						}
					else
						{
						$('#layout').append('<option value=""></option>');
						}
					for (i=0;i<obj.layouts.length;i++)
						{
						$('#layout').append('<option value="'+obj.layouts[i]+'">'+obj.layouts[i]+'</option>');
						}
					
					$('#layout').selectmenu('refresh')
					}
				
				}
			});

	}
function carga_dummies()
	{
		var tipo_local=document.getElementById('tipo_local').value;
		var id_punto=document.getElementById('punto').value;
		var layout=document.getElementById('layout').value;
		console.log("---"+layout+"---tipo:"+tipo_local+"--");
		var formData = new FormData();
		var dato='DUMMIES';
		formData.append("dato", dato);
		formData.append("tipo_local", tipo_local);
		formData.append("id_punto",id_punto);
		formData.append("layout",layout);
		formData.append("usuario", nombre_usuario);
		$.ajax({
			type: 'POST',
			url: servidor+'/bodega_lodis_movil/checklist_checklist_guarda_dato_app2.php',
			data: formData,
			processData: false,
			contentType: false,
			success: function (result) 
				{
				console.log(result);
				var obj = JSON.parse(result);
				
				if (obj.marcas!=null)
					{
					var test=new Array();
					$('#listado').empty().append();
					var tabla_html='';
					var activacion3="";
					tabla_html+='<div class="Table">';  
					tabla_html+='<div class="Heading">';  
					tabla_html+='<div class="Cell"><font face="Arial, Helvetica, sans-serif" color="#FFFFFF">SI</font></div>';  
					tabla_html+='<div class="Cell"><font face="Arial, Helvetica, sans-serif" color="#FFFFFF">MARCA</font></div>';  
					tabla_html+='<div class="Cell"><font face="Arial, Helvetica, sans-serif" color="#FFFFFF">MODELO</font></div>';  
					tabla_html+='<div class="Cell"><font face="Arial, Helvetica, sans-serif" color="#FFFFFF">NO</font></div>';  
					tabla_html+='</div>';  
					
					for (i=0;i<obj.marcas.length;i++)
						{
						//console.log("test:"+obj.tests[obj.id_items[i]]+"---");
						//console.log("NO APLICA:"+obj.nas[i]+"---");
						var activacion1="CHECKED";
						var activacion2="";
						//if (obj.tests[obj.id_items[i]]=='SI'){activacion1="CHECKED";}
						//if (obj.tests[obj.id_items[i]]=='NO'){activacion2="CHECKED";}
						//if (obj.nas[i]=='NO APLICA'){activacion3="CHECKED";}
						
						tabla_html+='<div class="Row">';  
						tabla_html+='<div class="Cell"><input type="radio" name="test'+i+'" '+activacion1+' id="test'+i+'" value="SI"></div>';  
						tabla_html+='<div class="Cell"><font face="Arial, Helvetica, sans-serif" size="2" color="#63666A">'+obj.marcas[i]+'</font></div>';  
						tabla_html+='<div class="Cell"><font face="Arial, Helvetica, sans-serif" size="2" color="#63666A">'+obj.modelos[i]+'</font></div>';  
						tabla_html+='<div class="Cell"><input type="radio" name="test'+i+'" '+activacion2+' id="test'+i+'" value="NO"></div>';  
						tabla_html+='</div>';  
						tabla_html+='<div class="Row">';  
						tabla_html+='<div class="Cell"></div>';
						tabla_html+='<div class="Cell"><font face="Arial, Helvetica, sans-serif" size="2" color="#63666A">'+obj.marcas[i]+'</font></div>';  
						tabla_html+='<div class="Cell"><font face="Arial, Helvetica, sans-serif" size="2" color="#63666A">'+obj.modelos[i]+'</font></div>';  
						tabla_html+='<div class="Cell"><input type="radio" name="test'+i+'" '+activacion2+' id="test'+i+'" value="NO"></div>';  
						
						/*
						tabla_html+='<div class="Cell"><font face="Arial, Helvetica, sans-serif" size="2" color="#63666A">'+obj.marcas[i]+'</font>';  
						tabla_html+='<div class="Cell"><select name="modelo_cambio<?=$pos?>" id="modelo_cambio<?=$pos?>" ></div>';  
						tabla_html+='<option value="<?=$modelo_cambio[$pos]?>"><?=$modelo_cambio[$pos]?></option>';
						tabla_html+='</select></div>';
						tabla_html+='<div class="Cell"><input type="radio" name="test'+i+'" '+activacion2+' id="test'+i+'" value="NO"></div>'; */ 
						tabla_html+='</div>';  
								}
					tabla_html+='</div>';
					tabla_html+='<select name="marca_cambio<?=$pos?>" id="marca_cambio<?=$pos?>" class"selectores"; onChange="form1.submit()">';  
					tabla_html+='<option value="<?=$marca_cambio[$pos]?>"><?=$marca_cambio[$pos]?></option>';
					tabla_html+='</select>';
					$('#listado').append(tabla_html);
					$('#marca').add();
					$('#marca').empty().append();
					$('#marca').append('<option value=""></option>');
					$('#marca').append('<option value="ffff">fffff</option>');
					$('#marca').selectmenu('refresh')
					document.getElementById('oculto').style.visibility='visible';
					}
				
				}
			});

	}
function carga_resultado()
	{
		var tipo_local=document.getElementById('tipo_local').value;
		var id_punto=document.getElementById('punto').value;
		var id_campana=document.getElementById('campana').value;
		var id_producto=document.getElementById('producto').value;
		document.getElementById('oculto').style.visibility='visible';
		////////////////////////////////////////////////////////////////////////
		
		var db = window.openDatabase("lodis", "1.0", "lodis DB", 900000); //will create database Dummy_DB or open it
		db.transaction(queryDB,errorCB);
		function queryDB(tx)
			{
			var f = new Date();
			var fechabase= f.getFullYear()+"-"+('0'+ (f.getMonth()+1)).slice(-2)+"-"+('0'+ f.getDate()).slice(-2);
			var h = new Date();
			var horabase= ('0'+ f.getHours()).slice(-2)+"-"+('0'+ f.getMinutes()).slice(-2)+"-"+('0'+ f.getSeconds()).slice(-2);
			
			console.log("datos:"+tipo_local+"-----"+id_punto+"-----");
			///id="'+id_programa+'"'
			tx.executeSql('SELECT * FROM checklist_imagen_cola where tipo="'+tipo_local+'" and id_punto="'+id_punto+'" and id_campana="'+id_campana+'" and id_producto="'+id_producto+'" and fecha_base="'+fechabase+'" ',[],querySuccess,errorCB);
			console.log( "Leyendo datos guardados." );
			}
		function errorCB(err) 
			{
			if(err.code!=0 && err.code!=undefined)
				{
					alert("Error processing SQL 2: "+err.code);
				}
			}
		function querySuccess(tx,result)
			{
			console.log( "Insert ok" );
			$.each(result.rows,function(index)
				{
				var row = result.rows.item(index);
				var id_imagen=row['id'];
				var ruta=row['ruta'];
				//alert ("lectura de ruta:"+ruta+"-id:"+id_imagen+"---");
				var photo = document.getElementById('photo');
	          	photo.src = ruta;
				document.getElementById('id_imagen').value=id_imagen;
				//lectura_tablas(ip,nombre_bd,usuariobd,passbd);
				});
			if (result.rows.length==0)
				{
				var photo = document.getElementById('photo');
	          	photo.src = "img/fondo.jpg";
				document.getElementById('id_imagen').value='';
				}
			}
		
		////////////////////////////////////////////////////////////////////////
				
		
		
		console.log("datos:"+id_producto+"---"+id_campana+"-----");
		var formData = new FormData();
		var dato='TAREAS';
		formData.append("dato", dato);
		formData.append("tipo_local", tipo_local);
		formData.append("id_punto", id_punto);
		formData.append("id_campana", id_campana );
		formData.append("id_producto", id_producto );
		formData.append("usuario", nombre_usuario);
		$.ajax({
			type: 'POST',
			url: servidor+'/bodega_lodis_movil/checklist_checklist_guarda_dato_app2.php',
			data: formData,
			processData: false,
			contentType: false,
			success: function (result) 
				{
				console.log(result);
				var obj = JSON.parse(result);
				if (obj.tarea!=null)
					{
					document.getElementById('tarea').innerHTML=obj.tarea;	
					}
				$('#estado_tarea').empty().append();
				if (obj.estado_tarea!='')
					{
					$('#estado_tarea').append('<option value="'+obj.estado_tarea+'">'+obj.estado_tarea+'</option>');
					}
				else
					{
					$('#estado_tarea').append('<option value=""></option>');
					}
				$('#estado_tarea').append('<option value="REALIZADO">REALIZADO</option>');
				$('#estado_tarea').append('<option value="PENDIENTE">PENDIENTE</option>');
				$('#estado_tarea').append('<option value="NO APLICA">NO APLICA</option>');
				
				$('#estado_tarea').selectmenu('refresh')
					
				}
			});

	}
function guarda_tarea()
	{
		var region=document.getElementById('region').value;
		var tipo_local=document.getElementById('tipo_local').value;
		var id_punto=document.getElementById('punto').value;
		var ele=document.getElementById('punto');
		var punto=document.getElementById('punto').options[ele.selectedIndex].text;
		var id_campana=document.getElementById('campana').value;
		var id_producto=document.getElementById('producto').value;
		var estado_tarea=document.getElementById('estado_tarea').value;
		var formData = new FormData();
		var dato='GUARDA_TAREA';
		formData.append("dato", dato);
		formData.append("region", region);
		formData.append("tipo_local", tipo_local);
		formData.append("id_punto", id_punto);
		formData.append("id_campana", id_campana);
		formData.append("id_producto", id_producto);
		formData.append("estado_tarea", estado_tarea);
		formData.append("usuario", nombre_usuario);
		$.ajax({
			type: 'POST',
			url: servidor+'/bodega_lodis_movil/checklist_checklist_guarda_dato_app2.php',
			data: formData,
			processData: false,
			contentType: false,
			success: function (result) 
				{
				console.log(result);
				var obj = JSON.parse(result);
				if (obj.resultado=='PROCESADO')
					{
					alert (obj.respuesta);	
					}
				if (obj.resultado=='SIGUE CHECKLIST')
					{
					location.href = "checklist.html?usuario="+usuario+"&password="+password+"&nombre_usuario="+nombre_usuario+"&region="+region+"&tipo_local="+tipo_local+"&id_punto="+id_punto+"&punto="+punto+"";
					alert (obj.respuesta);	
					}
				}
			});

	}
</script>
</head>

<body>
<div data-role="page" id="checklist">
  <div data-role="header">
    <h1>DUMMIES</h1>
  </div>
  <div data-role="content">
        <label for="region" class="select">Región:</label>
        <select name="region" id="region" onchange="carga_punto()">
        </select>
        <label for="tipo_local" class="select">Tipo Local:</label>
        <select name="tipo_local" id="tipo_local" onchange="carga_punto()">
        <option value=""></option>
        <option value="KIOSCO">KIOSCO</option>
        <option value="TIENDA">TIENDA</option>
        </select>
        <label for="punto" class="select">Punto:</label>
        <select name="punto" id="punto" onchange="carga_layout()">
        </select>
        <label for="layout" class="select">Layout:</label>
        <select name="layout" id="layout" onchange="carga_dummies()">
        </select>
        <div id="listado" style="width:100%; " align="center"></div>
 		<div id="oculto" style=" visibility:hidden;">
        <a href="#" data-role="button" id="procesar" onclick="procesar()">PROCESAR</a>
        </div>
        
  </div>
</div>


	  
</body>
</html>
